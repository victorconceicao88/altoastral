<!DOCTYPE html>
<html lang="pt">
<head>
  <!-- 1. Meta Tags Anti-Cache Extremas -->
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate, private, proxy-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  <!-- Mude de index.html para app.html -->
  <link rel="stylesheet" href="app.2025-06-04.css">
  <script src="app.2025-06-04.js"></script>
  
  <!-- 2. Controle de Versão Agressivo -->
  <script>
    (function() {
      // CONFIGURAÇÃO OBRIGATÓRIA: Atualize esta versão a cada deploy!
      const APP_VERSION = '2025-06-04-v6'; // Formato: ANO-MÊS-DIA-vX
      
      // Detecta navegadores problemáticos
      const isProblematicBrowser = 
        /Chrome|CriOS/i.test(navigator.userAgent) && 
        /Android|iPhone|iPad/i.test(navigator.userAgent);
      
      // Verifica se precisa atualizar
      const urlParams = new URLSearchParams(window.location.search);
      const shouldForceUpdate = 
        isProblematicBrowser ||
        !urlParams.has('v') ||
        urlParams.get('v') !== APP_VERSION;
      
      // Executa a atualização forçada
      if (shouldForceUpdate) {
        // Limpeza radical de cache
        if ('caches' in window) {
          caches.keys().then(names => {
            names.forEach(name => caches.delete(name));
            localStorage.clear();
            sessionStorage.clear();
          });
        }
        
        // Construção da nova URL
        const cleanUrl = window.location.href.split('?')[0].split('#')[0];
        const newUrl = `${cleanUrl}?v=${APP_VERSION}&ts=${Date.now()}&rand=${Math.random().toString(36).substr(2, 9)}`;
        
        // Redirecionamento nuclear (2 técnicas diferentes)
        try {
          if (isProblematicBrowser) {
            // Método 1: Para Chrome Mobile
            window.location.href = newUrl + '&chromeFix=1';
            setTimeout(() => {
              window.location.replace(newUrl + '&finalFix=1');
            }, 50);
          } else {
            // Método 2: Para outros navegadores
            window.location.replace(newUrl);
          }
        } catch (e) {
          // Método 3: Fallback absoluto
          document.body.innerHTML = `
            <div style="padding:20px;text-align:center;">
              <h1>Atualizando aplicativo...</h1>
              <p>Se não redirecionar em 5 segundos, <a href="${newUrl}">clique aqui</a></p>
            </div>
          `;
          setTimeout(() => window.location.href = newUrl, 3000);
        }
      }
    })();
  </script>

  <!-- Configurações Básicas -->
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
  
  <!-- Ícones e Manifesto PWA -->
  <link rel="icon" href="%PUBLIC_URL%/icons/logo-alto-astral.png" />
  <link rel="apple-touch-icon" href="%PUBLIC_URL%/icons/logo-alto-astral.png" />
  <link rel="manifest" href="%PUBLIC_URL%/manifest.json" />
  
  <!-- Metadados -->
  <meta name="theme-color" content="#b0aca6" />
  <meta name="description" content="Pedidos online do Alto Astral - Sabores que elevam seu astral!" />
  
  <!-- iOS meta tags -->
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="apple-mobile-web-app-title" content="Alto Astral" />
  
  <!-- Windows meta tags -->
  <meta name="msapplication-TileColor" content="#b0aca6" />
  <meta name="msapplication-TileImage" content="%PUBLIC_URL%/logo192.png" />
  
  <!-- Splash Screens PWA -->
  <link rel="apple-touch-startup-image" href="%PUBLIC_URL%/splash-640x1136.png" media="(device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" />
  <link rel="apple-touch-startup-image" href="%PUBLIC_URL%/splash-750x1334.png" media="(device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)" />
  <link rel="apple-touch-startup-image" href="%PUBLIC_URL%/splash-1242x2208.png" media="(device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)" />
  <link rel="apple-touch-startup-image" href="%PUBLIC_URL%/splash-1125x2436.png" media="(device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)" />
  
  <title>Alto Astral - Hamburgueria & Cafeteria</title>
</head>
<body>
  <noscript>Você precisa habilitar JavaScript para usar este aplicativo.</noscript>
  <div id="root"></div>
   <!-- 3. Script de Fallback para PWA -->
  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.getRegistrations().then(registrations => {
        registrations.forEach(registration => registration.unregister());
      });
    }
  </script>
</body>
</html>